# 进程模型
nbpt使用多线程上传和下载。

**给线程对象绑定一些函数和对象**。

创建上传任务：(参数列表)
- 参与上传的总线程数量n
- 生成下一块要处理的原始数据的函数() -> { 一块原始数据, 此块的id } 如果返回的id为-1则表明没有新块了。
- 一块数据被成功上传之后的回调(此块数据的id, 返回的url) -> void
- 一块数据上传失败之后的回调(此块数据id, 错误代码) -> void
- 一个长度为n的size_t序列的首地址，用于每一个线程汇报自己的上传速度(字节每秒)。

任务一旦创建就会立即开始，并且会一直阻塞直到最后一个上传任务成功。

创建下载任务：
- 参与下载的总线程数量n
- 生成下一块要下载的url的函数() -> { url字符串, 此块的id } 如果返回的字符串为NULL则表明没有新块了。
- 一块数据被成功下载之后的回调(此块数据的id, 下载好的数据块的保存位置) -> void
- 一块数据下载失败之后的回调(此块数据id, 错误代码) -> void
- 一个长度为n的size_t序列的首地址，用于每一个线程汇报自己的下载速度(字节每秒)。

如果工作正常，函数将会返回0,如果是异常退出，函数会返回-1.

当一个传输失败的时候，nbtp会尝试重试传输若干次，如果同一个任务反复失败超过3次，线程主函数将会退出返回-1。
